![i2c_1](https://github.com/user-attachments/assets/dab6c00c-6110-4b47-bcad-26afc8a915bf)

![i2c_2](https://github.com/user-attachments/assets/9f03ccfd-22db-4d70-a78c-14c5e9e77905)

![i2c_3](https://github.com/user-attachments/assets/38bb4fe6-41df-441b-a4d7-e9fa123d77e5)

### BMP280 I2C 온도 센서 리눅스 커널 드라이버 실습 보고서

#### 1. 개요
이번 실습에서는 **BMP280** 온도 및 압력 센서를 Raspberry Pi에 연결하고, 이를 위한 I2C 기반 **리눅스 커널 드라이버**를 작성하여 디바이스 파일을 통해 온도 데이터를 읽는 방법을 배웁니다. BMP280 센서를 통해 수집된 온도 데이터는 `/dev/bmp280` 디바이스 파일에서 읽을 수 있으며, `cat` 명령어를 통해 실시간으로 온도 값을 확인할 수 있습니다. 실습을 통해 I2C 프로토콜을 사용하여 센서 데이터를 처리하고, 드라이버 작동 원리를 확인합니다.

#### 3. 실습 목표
- BMP280 I2C 기반 리눅스 커널 드라이버 작성 및 구현
- I2C 주소 확인 및 센서 연결 상태 점검
- 커널 모듈을 통해 `/dev/bmp280` 파일을 생성하고, 이를 통해 온도 값을 읽음

#### 4. 실습 절차

##### 4.1 I2C 연결 확인
BMP280 센서가 Raspberry Pi에 정상적으로 연결되었는지 확인하기 위해, `i2cdetect` 명령어를 사용하여 I2C 장치의 주소를 확인했습니다. BMP280 센서의 I2C 주소는 **0x76**으로 표시되었습니다. 이 주소를 바탕으로 I2C 통신을 설정하였습니다.

##### 4.2 커널 모듈 코드 분석
- **I2C 어댑터와 클라이언트 설정**: 
  커널 드라이버에서 I2C 버스에 접근하기 위해 `i2c_adapter`와 `i2c_client` 구조체를 사용하여 어댑터와 클라이언트를 설정했습니다.
  
- **디바이스 파일 생성**: 
  드라이버에서 `device_create()` 함수를 사용하여 `/dev/bmp280` 파일을 생성하였습니다. 이 파일을 통해 유저 공간에서 커널 공간으로 데이터를 읽고 쓸 수 있게 됩니다.

##### 4.3 커널 모듈 빌드 및 로드
다음과 같은 명령어를 사용하여 작성한 커널 모듈을 빌드하고, 커널에 로드했습니다:

```bash
$ make
$ sudo insmod bmp280_driver.ko
```

모듈이 성공적으로 로드된 후, `dmesg` 명령어를 통해 커널 로그를 확인했습니다. 아래의 출력에서 BMP280 드라이버가 추가되고, I2C 주소 0x76으로 장치가 등록된 것을 확인할 수 있었습니다.

```bash
[ 667.081599] MyDeviceDriver - Device Nr 530579456 was registered
[ 667.081211] BMP280 Driver added!
[ 667.082463] ID: 0x58
```

##### 4.4 디바이스 파일 확인
디바이스 파일이 정상적으로 생성되었는지 확인하기 위해 다음 명령어를 실행했습니다:

```bash
$ ls /dev | grep bmp280
bmp280
```

이 명령어를 통해 `/dev/bmp280` 파일이 정상적으로 생성되었음을 확인했습니다.

##### 4.5 온도 데이터 읽기
디바이스 파일을 통해 온도 데이터를 읽기 위해, `cat` 명령어를 사용했습니다:

```bash
$ cat /dev/bmp280
28.28
28.28
28.28
```
