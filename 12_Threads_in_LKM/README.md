
# Linux Kernel Module: Kthread Example
## 관련개념
`kthread()`와 `kernel_thread()`는 리눅스 커널에서 커널 스레드를 생성하는 데 사용되는 함수들입니다. 이 함수들은 각각 특정 시점에서 커널 스레드 생성과 관리에 사용되었으며, 현대 리눅스 커널에서는 주로 `kthread` 관련 함수를 사용하여 커널 스레드를 관리합니다. 두 함수의 개념과 차이점, 그리고 사용 이유를 설명하겠습니다.

### 1. **kthread() 및 관련 함수들**

`kthread`는 커널 스레드를 생성하고 관리하는 데 사용되는 커널 API입니다. 커널 스레드는 사용자 공간이 아닌 커널 공간에서 실행되며, 커널 내에서 주기적인 작업이나 특정 작업을 비동기적으로 처리할 수 있도록 해줍니다. 리눅스 커널 2.6 이후로 `kthread` API가 도입되었으며, 현재 커널 스레드를 생성하는 데 권장되는 방법입니다.

#### `kthread`의 장점:
- 커널 스레드를 안전하게 생성하고 종료할 수 있는 고수준 API를 제공합니다.
- 스레드의 시작과 종료를 명시적으로 제어할 수 있습니다.
- 다양한 스레드 관련 함수들을 활용해 스레드 동작을 세밀하게 관리할 수 있습니다.

### 2. **kernel_thread()**
`kernel_thread()`는 리눅스 커널에서 커널 스레드를 생성하는 함수로, `kthread()` 함수가 도입되기 전에는 커널 스레드를 생성하는 기본 방법이었습니다. 이 함수는 현재는 구식 방식으로, 대부분의 최신 리눅스 커널에서는 더 이상 사용되지 않으며 `kthread` API가 그 역할을 대체하고 있습니다.

### 3. **`kthread()`와 `kernel_thread()`의 차이점**

| **특징**                   | **kthread()**                                      | **kernel_thread()**                             |
|----------------------------|---------------------------------------------------|-------------------------------------------------|
| **사용 여부**              | 현재 사용되는 커널 스레드 생성 방식               | 오래된 방식, 현재는 잘 사용되지 않음            |
| **사용법**                 | 고수준 API로 간편하게 커널 스레드를 생성하고 관리 | 더 낮은 수준의 API로, 추가적인 제어 필요        |
| **스레드 종료**            | `kthread_stop()` 및 `kthread_should_stop()` 제공   | 수동으로 스레드 종료 처리가 필요함             |
| **추가 기능**              | 스레드 이름 지정, 스레드 시작/종료 제어 등 기능 제공 | 기본적인 스레드 생성만 가능                     |
| **도입 시기**              | 리눅스 커널 2.6 이후                               | 구식 API, 리눅스 커널 2.6 이전 사용             |


## 설명
간단한 실습을 통해 커널 스레드(kthread)의 사용법을 보여줍니다. 이 모듈은 두 개의 커널 스레드를 생성하여 각각의 카운터를 증가시키고, 해당 활동을 커널 로그에 기록합니다.
이 실습은 리눅스 커널 모듈 내에서 커널 스레드를 생성하고 관리하는 방법을 설명합니다.

- kthread 1은 1초마다 실행됩니다.
- kthread 2는 2초마다 실행됩니다.

## 커널 로그 출력

다음은 모듈을 로드한 후 kthread의 동작을 관찰한 커널 로그의 샘플 출력입니다:

![1](https://github.com/dlgus8648/Linux_device_driver/assets/139437162/a8af8cb0-1f3a-4512-9faa-0b6a81d9b496)


